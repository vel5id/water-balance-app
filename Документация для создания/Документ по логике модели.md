# **Технический план разработки Гидрологической Балансовой Модели**

## **1\. Общие сведения о модели**

**Название модели:** Гидрологическая Балансовая Модель с Динамической Площадью (Hypsography-Driven Water Balance Model).

**Цель:** Моделирование и прогнозирование динамики объема (V) и уровня (L) воды в водном объекте на ежедневной основе.

**Ключевой принцип:** На каждом временном шаге модель рассчитывает изменение объема, используя Гипсографическую Кривую для определения площади водного зеркала, участвующей в процессах осадков и испарения.

## **2\. Входные данные и их роль**

| Источник данных | Переменные | Роль в модели |
| :---- | :---- | :---- |
| **Геопространственные (DEM)** | Батиметрия \+ DEM Copernicus | **Критическая.** Используется для создания **Гипсографической Кривой** (связи L \<-\> A \<-\> V). |
| **Климатические (raw\_nc ERA5)** | total\_precipitation (P) | Ежедневные осадки в мм. Основной приток. |
| **Климатические (raw\_nc ERA5)** | total\_evaporation (ET) | Ежедневное испарение/эвапотранспирация в мм. Основная потеря. |
| **Климатические (raw\_nc ERA5)** | 2m\_temperature (T) | Используется для определения фазы осадков и расчета **снеготаяния** (M) при необходимости. |
| **Климатические (raw\_nc ERA5)** | runoff | Используется для оценки **притока с водосбора** (Q\_in). |
| **Данные валидации (Sentinel-2)** | Площадь NDWI (A\_NDWI) | Используется исключительно для **Калибровки и Валидации** модели. |

## **3\. Этап подготовки: Построение Гипсографической Кривой**

Прежде чем запустить балансовое уравнение, необходимо создать статическую связь между уровнем, площадью и объемом.

### **3.1. Определение Гипсографических Функций**

Используя объединенную DEM (дно водоема), необходимо создать набор данных, который позволит вычислять любую из трех величин по одной из известных:

1. **Функция Площади по Уровню (A \= f\_A(L)):** Площадь водного зеркала при определенном уровне.  
2. **Функция Объема по Уровню (V \= f\_V(L)):** Накопленный объем воды от самой глубокой точки до уровня L.  
3. **Функция Уровня по Объему (L \= f\_L(V)):** Уровень воды при известном объеме.

Эти функции могут быть представлены либо в виде таблицы (LUT — Lookup Table), либо аппроксимированы полиномом, в зависимости от сложности батиметрии.

### **3.2. Начальные условия**

Для запуска модели требуется:

* **Начальный Объем (V\_0):** Объем воды в объекте на дату t=0.  
* **Начальный Уровень (L\_0):** Уровень воды, соответствующий V\_0 по функции L \= f\_L(V).

## **4\. Основная Формула Водного Баланса**

Модель использует ежедневный временной шаг (Delta\_t \= 1 день). Все объемы должны быть приведены к единой размерности, например, в кубические метры (м3).

### **4.1. Общий баланс объема**

Новый объем V(t+1) на следующий день рассчитывается как:

V(t+1) \= V(t) \+ Delta\_V\_Total

Где Delta\_V\_Total — общее изменение объема за день t:

Delta\_V\_Total \= (V\_P \+ V\_M) \- V\_ET \+ Q\_in \- Q\_out

### **4.2. Расчет компонент в м3/день**

| Компонент | Расчетная формула | Описание |
| :---- | :---- | :---- |
| **Осадки (V\_P)** | (P\_mm(t) \* A(V\_t) / 1000\) \* P\_scale | P\_mm(t) (мм/день) из ERA5. A(V\_t) — площадь в м2, полученная из Гипсографической Кривой для текущего объема V\_t. Деление на 1000 — перевод из мм в м. |
| **Таяние (V\_M)** | Отдельная подмодель таяния M\_mm(t) | Вклад снеготаяния. Рассчитывается с использованием T\_2m и snow\_depth. **Критично:** если осадки были в виде снега, они сначала накапливаются в снежном покрове, а затем входят в баланс через V\_M. Если снеготаяние не моделируется, V\_M \= 0, и P\_mm используется напрямую. |
| **Испарение (V\_ET)** | (ET\_mm(t) \* A(V\_t) / 1000\) \* ET\_scale | ET\_mm(t) (мм/день) из ERA5. Потери с поверхности A(V\_t). |
| **Поверхностный приток (Q\_in)** | Q\_in(t) \* Q\_scale | Речной/склоновый сток с водосбора (в м3/день). Может быть оценен на основе runoff ERA5, масштабированного по площади водосбора. |
| **Потери (Q\_out)** | Q\_out(t) | Объем оттока через сток/сброс/инфильтрацию (в м3/день). Требует эмпирической или гидравлической модели (например, отток зависит от уровня L\_t). |

## **5\. Процесс моделирования и шаги**

### **Шаг 1: Инициализация**

1. Загрузить и проинтерполировать климатические ряды ERA5 до ежедневного разрешения.  
2. Задать начальные условия (V\_0, L\_0).

### **Шаг 2: Временной цикл (для каждого дня t)**

1. **Определение площади:** По текущему объему V\_t определить площадь водного зеркала A(V\_t) через Гипсографическую Кривую A \= f\_A(V\_t).  
2. **Обработка климата (P, ET, T):** Извлечь P\_mm(t), ET\_mm(t), T\_2m(t).  
3. **Расчет притоков/потерь:** Рассчитать V\_P, V\_M (если есть подмодель таяния), V\_ET, Q\_in, Q\_out.  
4. **Обновление объема:** Вычислить V(t+1) \= V(t) \+ Delta\_V\_Total.  
5. **Обновление уровня и площади:** Найти новый уровень L(t+1) и площадь A(t+1) по Гипсографическим Функциям L \= f\_L(V(t+1)) и A \= f\_A(L(t+1)).

### **Шаг 3: Калибровка и Валидация (Роль NDWI)**

Калибровка модели выполняется путем минимизации разницы между моделируемой площадью и площадью, полученной по NDWI (на даты, когда есть спутниковые снимки).

Функция потерь (Loss Function):  
Минимизация среднеквадратичной ошибки (RMSE) между:  
A\_predicted(t\_NDWI) и A\_NDWI(t\_NDWI)

Регулируемые параметры для калибровки:

* P\_scale  
* ET\_scale  
* Q\_scale (коэффициент масштабирования для поверхностного притока)  
* Параметры, управляющие Q\_out (например, скорость инфильтрации или коэффициент сброса).

После калибровки модель готова к прогнозированию.